# 작심삼일 루틴 챌린지 (Apps in Toss) — PRD v1.1

---

## 문서 메타

| 항목 | 내용 |
|---|---|
| 문서명 | 작심삼일 루틴 챌린지 (2주 MVP) PRD |
| 문서 버전 | v1.1 (v1.0 → 정책 확정 반영) |
| 작성일 | 2026-02-21 |
| 작성자 | Assistant (Claude Sonnet 4.6) |
| 대상 | 앱인토스(Apps in Toss) 런칭 — 비게임 |
| 앱 스킴 | `jaksim-routine` |

### 변경 요약 (v0.6 → v1.0)

1. **정책/검수 섹션 전면 보강** — 비게임 출시 체크리스트(최신 문서) 기반으로 15개 항목 전체 매핑
2. **라이트모드 고정** 정책 추가 (앱인토스 다크모드 미지원, 검수 반려 사유)
3. **핀치줌 비활성화** meta viewport 요건 명시
4. **내비게이션 바 스펙** 상세화 (브랜드 로고 필수, 홈·더보기·닫기 구성)
5. **토스 로그인 규칙** 상세화 — 3rd party 로그인 불가, 인트로 화면 필수, 닫기 동작 분기 명시
6. **IAP 체크리스트** — 구독 상품 불가 → "기간형 이용권"으로 표현 정정, 기기 변경 후 데이터 유지 요건 추가
7. **서비스 오픈 정책 리스크 검토 완료** — 습관 기록 도구로 제한 서비스 미해당 확인
8. **자사 앱/외부 링크** 사용 계획 없음으로 명시
9. **화면별 상세 스펙** — 온보딩 카피/홈/루틴 상세/페이월 와이어텍스트 기반 전 화면 확장
10. **배포/출시/운영 섹션** — 검토 요청 전 필수 확인 항목, 롤백/핫픽스 시나리오 추가

### 변경 요약 (v1.0 → v1.1)

1. **건너뜀 정책 확정** — SKIPPED 시 스트릭 리셋 + 실행 전 경고 토스트 표시
2. **프리미엄 만료 후 초과 루틴 처리 확정** — 3개 초과분 숨김 처리 (데이터 보존, 재구매 시 복원)
3. **데이터 초기화 범위 확정** — 온보딩 플래그 포함 전체 초기화 (온보딩 재표시)
4. **무료 체험 만료 인앱 안내 확정** — 만료 후 첫 접속 시 인앱 배너 표시 (푸시 없음)
5. **배지 5종 확정** — 첫 체크인 / 3일 연속 / 7일 연속 / 2주 완주(14일) / 복귀

---

## 1페이지 요약

**문제** 루틴이 끊기면 "실패"로 인식돼 재진입이 어려워져요.

**핵심 가치** "2주만 버티게 만드는 체크인 루프" + "실패해도 재진입이 쉬운 UX(다시 시작하기)"

**대상 사용자** 운동·공부·절약·청소·독서 같은 단순 루틴을 2주 단위로 이어가고 싶은 사용자

**MVP 핵심 기능**
1. 루틴 템플릿 + 커스텀 생성 (Free 최대 3개)
2. 매일 원탭 체크인(완료/건너뜀) + 한줄 메모(선택)
3. 스트릭/배지
4. 주간 리포트 (월~일 고정, KST)
5. "다시 시작하기 🔄" (핵심 복귀 UX)
6. 프리미엄: 월간/연간 이용권(IAP) + 고급 통계 + 템플릿 팩 + 7일 무료 체험(1회)

**수익화** IAP 기간형 이용권 — 월 1,900원 / 연 14,900원

**핵심 제약(앱인토스)**
- 토스 로그인만 허용 (타사 로그인 불가)
- 구독 상품 제공 불가 → 기간형 이용권(비소모품) 사용
- 외부 링크/자사 앱 설치 유도 금지
- 라이트 모드 고정
- 핀치줌 비활성화 필수

---

## 3. 목표와 성공지표

### 목표 (정량)

| 지표 | 목표값 |
|---|---|
| D1 리텐션 | 35%+ |
| D7 리텐션 | 15%+ |
| 2주 완주율 (14일 중 체크인 10일+) | 20%+ |
| 온보딩 후 5분 내 루틴 1개 생성 전환 | 60%+ |
| 주간 리포트 조회율 (주 1회+) | 40%+ |
| 페이월 노출 대비 프리미엄 전환 | 3%+ |

### 목표 (정성)
- "끊겨도 다시 시작하기 쉬워요" 피드백 확보
- 결제 불만(강제 유도/불명확/복원 불가) CS 최소화

### 가드레일
- 결제 유도: "무료로 계속 쓰기 (3개 제한)" 항상 제공
- 문구: 치료·진단·의학적 효과·우울·불안 개선 표현 금지
- 무료 기능만으로도 2주 루프 완주 가능해야 해요.

### 분석 이벤트 설계 개요
- 주요 퍼널: 온보딩 진입 → 루틴 생성 → 첫 체크인 → 스트릭 7일 → 페이월 노출 → 구매
- SDK: 앱인토스 Analytics SDK (`Analytics` 초기화 필수)

---

## 4. 범위

### MVP 범위 (In)
- 온보딩 3스크린 (확정 카피)
- 루틴 템플릿 선택 / 커스텀 생성 (Free 최대 3개)
- 오늘 체크인 (완료/건너뜀) + 메모(선택)
- 루틴 상세 (최근 2주 기록, 스트릭, 편집, 다시 시작)
- 주간 리포트 (월~일 고정, KST)
- 배지 기본 5종
- 페이월 + 월간/연간 이용권(IAP) + 7일 무료 체험(1회)
- 로컬 저장(Storage) + 데이터 초기화(설정)
- 이용권 복원 (미결 주문 처리 포함)
- 프리미엄 만료 후 초과 루틴 숨김/복원
- 무료 체험 만료 후 접속 시 인앱 배너

### 비범위 (Out)
- 친구/랭킹/초대/공유 리워드
- 강제 알림/푸시 (옵트인만 Phase 2)
- 상담·코칭·치료 등 의료·심리 서비스
- 외부 링크 / 자사 앱 설치 유도

### Phase 2 (Backlog)
- 옵트인 리마인드 알림 (스마트 발송 SDK)
- 데이터 내보내기 (CSV) + 주간 리포트 공유 카드 (OG)
- 로컬 → 클라우드 동기화

---

## 5. 사용자 & 시나리오

### 핵심 페르소나

| 페르소나 | 특징 | 핵심 니즈 |
|---|---|---|
| 퇴근 후 운동하려는 직장인 | 루틴이 끊기면 쉽게 포기 | "작심삼일 OK" → 쉬운 재진입 |
| 완벽주의 없이 공부 기록하고 싶은 수험생 | 기록을 못 하면 자책 | 체크하지 않아도 기록이 남는 UX |
| 절약·정리 습관을 최소 노력으로 유지하려는 사용자 | 앱 진입 장벽이 낮아야 함 | 원탭 체크 + 간단한 메모 |

### 핵심 유저 여정

진입 → 온보딩(실패 수용 메시지) → 루틴 선택/생성 → 오늘 체크(원탭) → 스트릭 확인 → 주간 리포트 → 스트릭 끊김 → 다시 시작하기 → 루틴 4개째 생성 시도 → 페이월 노출 → 무료 체험 또는 구매 → 이용권 유지·복원

---

## 6. 정책/검수/컴플라이언스 (앱인토스 전용)

### 앱 유형 판정
- 습관·루틴 기록 도구이며 게임성(등급/리더보드/사행성) 없음 → **비게임**
- 적용 체크리스트: [비게임 출시 가이드](https://developers-apps-in-toss.toss.im/checklist/app-nongame.md)

### 서비스 오픈 정책 리스크 검토

| 제한 항목 | 해당 여부 | 근거 |
|---|---|---|
| 디지털 자산/가상자산 | ❌ 비해당 | 습관 기록만 제공 |
| 자금세탁 가능성 | ❌ 비해당 | IAP 기간형 이용권, 환금성 없음 |
| 사행성/복권/베팅 | ❌ 비해당 | 배지·스트릭은 사행성 요소 없음 |
| 금융 상품 중개 | ❌ 비해당 | 해당 없음 |
| 의료/비대면 진료 수익화 | ❌ 비해당 | "심리/의학적 효과" 표현 전면 금지 |
| 동일 기능 중복 앱(어뷰징) | ❌ 비해당 | 단일 앱 출시 |
| 홍보 전용 앱 | ❌ 비해당 | 독립 기능 제공 |

→ **서비스 오픈 정책 제한 사유 없음** (확인 완료)

### 자사 앱/외부 링크 정책

- 자사 앱 설치 유도: **사용 계획 없음**
- 외부 링크: **사용 계획 없음**
- 고객센터 이메일만 외부 연결 (법률상 필수 안내 목적 → 허용)
- 이용약관·개인정보처리방침: 미니앱 내 WebView로 내부 표시 권장

### UX 가이드 (다크패턴 방지) 준수 항목

- 결제 유도: "무료로 계속 쓰기 (3개 제한)" 항상 제공, 페이월 자동 팝업 금지
- 무료 체험 만료 시 자동 결제 없음 (기간형 이용권 구조)
- 구독 취소 방해 없음 (이용권 만료 후 자동 종료)
- 허위/과장 문구 없음 ("무제한" 대신 "개수 제한 없음" 등 정확한 표현)
- 빈 상태/에러 시 사용자 탓 문구 금지

### UX 라이팅 규칙 요약

| 규칙 | 적용 예시 |
|---|---|
| 해요체 사용 | "체크하세요" → "체크해요" |
| 능동형 문장 | "체크가 완료되었습니다" → "체크했어요" |
| 긍정형 문장 | "미완료가 아닌 경우" → "완료한 경우" |
| 과도한 경어 금지 | "이용해 주시겠습니까" → "이용해 볼까요" |
| 한 줄 원칙 | 버튼 문구는 15자 이내 |
| 마침표 생략 | 버튼/제목에는 마침표 쓰지 않아요 |
| 숫자는 아라비아 | "2개" (O), "두 개" (X) |

### 기술 제약

- **iframe**: 앱인토스 WebView 미니앱 특성상 iframe 내부 콘텐츠의 스크롤/이벤트 전달 이슈 가능 → iframe 사용 최소화
- **라이트 모드 고정**: 앱인토스는 다크모드 미지원 → 미니앱 테마·내비게이션 바 모두 라이트 모드 고정
- **핀치줌 비활성화**: meta viewport에 `initial-scale=1, maximum-scale=1, user-scalable=no` 필수
- **외부 URL 열기**: `openURL` SDK만 사용 (직접 `window.open` 지양)
- **스크롤/인터랙션**: 2초 이상 지연 금지 (검수 반려 사유)

### 검수 체크리스트 (필수/선택)

| 구분 | 항목 | 필수/선택 | 완료 기준 |
|---|---|---|---|
| 시스템 | 라이트 모드 고정 | ✅ 필수 | 다크모드 전환 시에도 라이트 유지 |
| 시스템 | 핀치줌 비활성화 | ✅ 필수 | viewport meta 설정 확인 |
| 내비게이션 | 브랜드 로고 + 이름 노출 | ✅ 필수 | 콘솔 등록 로고와 일치 |
| 내비게이션 | 더보기 버튼 (⋯) 노출 | ✅ 필수 | 신고하기·공유하기 포함 |
| 내비게이션 | 닫기 버튼 (X) 노출 | ✅ 필수 | 미니앱 종료 동작 |
| 내비게이션 | 홈 버튼 | 선택 | 미니앱 홈으로 이동 |
| 동작 | 2초 이내 인터랙션 응답 | ✅ 필수 | 로딩 스피너로 피드백 제공 |
| 동작 | 재접속 시 데이터 유지 | ✅ 필수 | Storage 기반 로컬 저장 |
| 동작 | 기능화되지 않은 컴포넌트 없음 | ✅ 필수 | 모든 버튼·링크 정상 동작 |
| 앱 내 기능 | 딥링크 3개 등록 + 정상 동작 | ✅ 필수 | 스킴 진입 → 뒤로가기 → 홈 복귀 |
| 토스 로그인 | 3rd party 로그인 없음 | ✅ 필수 | 토스 로그인만 사용 |
| 토스 로그인 | 인트로 화면 제공 | ✅ 필수 | 서비스 소개 후 로그인 유도 |
| 토스 로그인 | 닫기 시 동작 분기 | ✅ 필수 | 인트로: 미니앱 닫힘 / 중간: 이전 화면 |
| 토스 로그인 | 로그인 해제 시 데이터 초기화 | ✅ 필수 | 재접속 시 로그인 재요청 |
| IAP | 표시 금액 = 실제 결제 금액 일치 | ✅ 필수 | 콘솔 상품 가격과 UI 일치 |
| IAP | 결제 취소 시 이전 화면 복귀 | ✅ 필수 | 취소 후 페이월 복귀 |
| IAP | 결제 실패 시 오류 안내 | ✅ 필수 | 에러 코드별 안내 문구 제공 |
| IAP | 기기 변경 후 이용권 복원 | ✅ 필수 | 로그인 후 `getPendingOrders` 복원 |
| IAP | 구독 상품 없음 | ✅ 필수 | 기간형 이용권(비소모품)으로 구성 |
| IAP | 결제 내역 확인 기능 제공 | ✅ 필수 | 설정 > 이용권 내역 화면 |
| IAP | processProductGrant 30초 내 완료 | ✅ 필수 | 서버 SLA 30초 이내 |
| 권한 | 불필요한 권한 없음 | ✅ 필수 | 콘솔 번들 업로드 후 권한 목록 확인 |
| 데이터 | 과도한 메모리 누수 없음 | ✅ 필수 | 10분 사용 후 메모리 이상 없음 |
| 보안 | HTTPS 통신만 사용 | ✅ 필수 | HTTP 혼용 없음 |
| UX | 다크패턴 없음 | ✅ 필수 | 다크패턴 방지 정책 자체 검수 |
| UX | 접근성 (명도 대비/터치 영역) | 권장 | WCAG AA 기준 |
| 접근성 | 스크린 리더 주요 콘텐츠 순서 | 권장 | 논리적 읽기 순서 확인 |

---

## 7. 정보구조 (IA) & 내비게이션

### 탭 구조

```
홈 (오늘 체크인)  |  리포트 (주간)  |  설정
```

### 화면 트리

```
Onboarding
  └─ OB-1: 실패 수용
  └─ OB-2: 원탭 체크인 소개
  └─ OB-3: 복귀 설계 + 루틴 시작하기

Tabs
  ├─ HOME: 오늘 체크인
  │    └─ R-NEW: 루틴 선택/생성
  │    └─ R-DETAIL: 루틴 상세
  │         └─ R-EDIT: 루틴 설정(편집)
  ├─ REPORT: 주간 리포트
  └─ SETTINGS: 설정
       └─ PAYWALL: 프리미엄 이용권

모달/오버레이
  └─ CHECKIN-MEMO: 한줄 메모 입력
  └─ BADGE: 배지 획득 팝업
  └─ CONFIRM-RESTART: 다시 시작 확인
```

### 앱 내 기능 (딥링크) 진입점

| 번호 | 기능명 | 스킴 | 동작 |
|---|---|---|---|
| 1 | 오늘 루틴 체크하기 | `intoss://jaksim-routine/home` | 홈(오늘 체크인) 직접 진입 |
| 2 | 주간 리포트 보기 | `intoss://jaksim-routine/report` | 리포트 탭 직접 진입 |
| 3 | 루틴 만들기 | `intoss://jaksim-routine/routine/new` | 루틴 생성 화면 직접 진입 |

> 뒤로가기 시 미니앱 홈(HOME)으로 랜딩 필수

---

## 8. 화면별 상세 스펙

### 화면 목록

| Screen ID | 목적 | 진입 조건 | 주요 행동 |
|---|---|---|---|
| OB-1~3 | 온보딩 | 첫 실행(로컬 플래그) | 다음 / 루틴 시작하기 / 나중에 |
| HOME | 오늘 체크인 | 온보딩 완료 후 메인 | 완료/건너뜀 원탭, 루틴 추가, 리포트 이동 |
| R-NEW | 루틴 생성 | 홈 > + 루틴 추가 | 템플릿 선택 또는 커스텀 입력 |
| R-DETAIL | 루틴 상세 | 홈 > 루틴 카드 탭 | 편집, 다시 시작, 메모 조회 |
| R-EDIT | 루틴 설정 | R-DETAIL > 편집 | 요일/목표 저장 |
| REPORT | 주간 리포트 | 리포트 탭 | 완료율 확인, 공유(Phase 2) |
| PAYWALL | 이용권 전환 | Free 루틴 3개 초과 시도 / 설정 | 무료 체험 / 구매 / 무료로 계속 |
| SETTINGS | 설정 | 설정 탭 | 이용권 복원, 데이터 초기화, 약관 |
| BADGE-POPUP | 배지 획득 | 조건 달성 시 자동 | 확인 |

---

### OB-1 ~ OB-3: 온보딩

**OB-1 카피 (확정)**
```
🔥

작심삼일, 괜찮아요.
4일째 다시 시작하면 되니까.

습관은 완벽하게 지키는 게 아니라
계속 돌아오는 거예요.

[다음]
```

**OB-2 카피 (확정)**
```
✅

오늘 할 일, 딱 하나만 체크해요.

매일 원탭으로 기록하고
일주일 뒤 얼마나 달라졌는지 확인해요.

"이번 주 완료율 71% — 지난주보다 14% 올랐어요"

[다음]
```

**OB-3 카피 (확정)**
```
🏅

실패해도 기록은 남아요.
그 기록이 다시 시작할 이유가 됩니다.

2주만 해봐요.
그다음은 알아서 됩니다.

[루틴 시작하기]  [나중에]
```

| 상태 | 처리 |
|---|---|
| "나중에" 탭 | 온보딩 완료 플래그 저장 + HOME 진입 |
| "루틴 시작하기" 탭 | 온보딩 완료 + R-NEW 진입 |
| 재진입(완료 플래그 있음) | OB 생략, HOME 직접 진입 |

---

### HOME: 오늘 체크인

**와이어텍스트 기반 UI 구성**

```
══════════════════════════════════════
[ 홈 — 오늘 체크인 ]
내비게이션 바: [로고+이름] [더보기⋯] [X]
──────────────────────────────────────
  2월 19일 수요일   🔥 스트릭 5일째

  오늘의 루틴
  ──────────────────────────────────
  ○  운동 30분          [완료]
  ○  책 10페이지        [완료]
  ○  절약 기록          [건너뜀]
  ──────────────────────────────────
  오늘 완료  2 / 3

  📊 이번 주 완료율  71%
     지난주보다 +14% ↑

  [+ 루틴 추가]     [주간 리포트 →]
══════════════════════════════════════
```

| 속성 | 내용 |
|---|---|
| TDS 컴포넌트 | ListRow(루틴 카드), BottomCTA(루틴 추가 버튼), Badge(스트릭) |
| 완료/건너뜀 | 완료: 원탭 토글 → Checkin(status: COMPLETED) 저장 / 건너뜀: 경고 토스트 먼저 노출 → 확인 후 Checkin(status: SKIPPED) 저장 + 스트릭 리셋 |
| 건너뜀 경고 토스트 | "건너뜀으로 기록하면 스트릭이 초기화돼요." (하단 토스트, 2초 노출) → 사용자가 확인 탭 후 저장 |
| 오늘 날짜 | `getServerTime()` 또는 KST 로컬 시간 (Asia/Seoul) |
| 빈 상태 | 루틴 없음 → "첫 루틴을 만들어볼까요?" + [루틴 만들기] 버튼 |
| 에러 | Storage 읽기 실패 → 토스트: "데이터를 불러올 수 없어요. 다시 시도해요." |
| 로딩 | 스피너 표시, 2초 이내 완료 목표 |
| 이벤트 | `home_view`, `checkin_complete`, `checkin_skip` |

---

### R-NEW: 루틴 선택/생성

**UI 구성요소**
- 템플릿 목록 (운동 / 공부 / 절약 / 청소 / 독서 + 직접 입력)
- 루틴 이름 입력 (최대 20자)
- 목표 요일 선택 (월~일 멀티 선택)
- 저장 버튼 (BottomCTA)

**상태/예외**

| 상태 | 처리 |
|---|---|
| 프리미엄 만료 후 루틴 처리 | 이용권 만료 시 3개 초과분 **숨김 처리** (archivedAt 설정). 데이터는 보존되며 재구매 시 자동 복원. 홈 화면에 "3개를 초과한 루틴 N개가 숨겨졌어요. 이용권을 구매하면 다시 볼 수 있어요." 배너 표시 |
| 무료 체험 만료 후 접속 안내 | 만료 후 첫 접속 시 인앱 배너 표시: "7일 무료 체험이 끝났어요. 계속 사용하려면 이용권을 구매해요." (배너 닫기 가능) |
| 이름 비어있음 | 저장 버튼 비활성, "루틴 이름을 입력해요" 안내 |
| 요일 미선택 | 저장 버튼 비활성 |

**이벤트** `routine_create_start`, `routine_create_complete`, `routine_template_select`

---

### R-DETAIL: 루틴 상세

**와이어텍스트 기반 UI 구성**

```
══════════════════════════════════════
[ 루틴 상세 — 운동 30분 ]
──────────────────────────────────────
  운동 30분
  목표 요일     월 화 수 목 금
  시작일        2026.02.10
  현재 스트릭   🔥 5일 연속
  누적 완료     9회 / 14일
  ──────────────────────────────────
  📅 최근 2주 기록
     ■ ■ ■ □ ■ ■ ■ □ □ ■ ■ ■ □ ■
     (■ 완료 / □ 미완료/건너뜀)
  ──────────────────────────────────
  📝 오늘 한줄 메모 (선택)
     "오늘은 팔굽혀펴기 30개 추가"

  [편집]          [다시 시작하기 🔄]
══════════════════════════════════════
```

| 기능 | 동작 |
|---|---|
| 편집 | R-EDIT으로 이동 |
| 다시 시작하기 | 확인 다이얼로그 → `restartAt` 업데이트, 스트릭 초기화 |
| 메모 탭 | CHECKIN-MEMO 오버레이 |
| 빈 상태 (기록 없음) | "아직 기록이 없어요. 오늘 첫 체크인을 해봐요!" |

**이벤트** `routine_detail_view`, `routine_restart`

---

### REPORT: 주간 리포트

**UI 구성요소**
- 주간 기간 표시 (월~일, KST)
- 루틴별 완료율 + 최고 요일
- 전체 완료율 + 지난주 대비 증감
- 규칙 기반 코멘트 (예: "화요일에 가장 잘 하셨어요!")
- 배지 현황

**규칙 기반 코멘트 예시**

| 조건 | 코멘트 |
|---|---|
| 완료율 80%+ | "이번 주 최고예요! 🎉" |
| 완료율 50~79% | "절반 이상 해냈어요 💪" |
| 완료율 < 50% | "다시 시작해도 괜찮아요. 다음 주가 있어요 🔄" |
| 지난주 대비 +10%+ | "지난주보다 N% 올랐어요 ↑" |

**이벤트** `report_view`, `report_week_change`

---

### PAYWALL: 프리미엄 이용권

**와이어텍스트 기반 UI 구성**

```
══════════════════════════════════════
[ 결제 전환 — 프리미엄 이용권 ]
──────────────────────────────────────
  루틴이 3개를 넘었어요.
  더 많은 루틴을 관리해볼까요?

  ✓ 루틴 개수 제한 없음
  ✓ 월간·분기 통계 리포트
  ✓ 루틴 템플릿 팩 (운동 / 공부 / 절약)

  [콘솔 상품 동적 표시: getProductItemList()]
  월 1,900원   or   연 14,900원 (35% 절약)

  · 언제든지 해지 가능 (자동 갱신 없음)
  · 7일 무료 체험 제공
  · 스트릭이 끊겨도 기록은 사라지지 않아요

  [7일 무료로 시작하기]
  [무료로 계속 쓰기 (3개 제한)]
══════════════════════════════════════
```

**중요 정책**

| 항목 | 내용 |
|---|---|
| 상품명·가격 | `getProductItemList()` 동적 표시 (하드코딩 금지) |
| 무료 체험 | userKeyHash 기준 1회 제한 (서버 기록) |
| "무료로 계속 쓰기" | 항상 표시, 탭 시 페이월 닫힘 |
| 구독 상품 | 제공 불가 → 기간형 이용권(비소모품)으로 구성 |
| 자동 결제 | 없음 (만료 후 수동 구매 필요) |

**이벤트** `paywall_view`, `paywall_start_trial`, `iap_purchase_start`, `iap_grant_success`, `iap_grant_fail`

---

### SETTINGS: 설정

**UI 구성요소**

- 이용권 상태 (활성/만료/미구매)
- 이용권 복원하기 버튼
- 이용권 구매 내역 보기
- 데이터 초기화 (루틴/체크인/배지 삭제)
- 이용약관 / 개인정보처리방침
- 고객센터 연락처

**데이터 초기화 동작**
- 확인 다이얼로그: "정말 초기화할까요? 모든 루틴과 체크인 기록이 삭제돼요."
- 삭제 항목: 루틴 / 체크인 / 배지 / 이용권 캐시 / **온보딩 플래그** (온보딩 재표시)
- 초기화 완료 후 온보딩 OB-1부터 재진입

**이벤트** `settings_view`, `iap_restore_start`, `iap_restore_done`, `data_reset`

---

## 9. 기능 요구사항

### P0 (런칭 필수)

| 기능 | 상세 |
|---|---|
| 온보딩 (3스크린) | 확정 카피 적용, 1회만 표시 |
| 루틴 생성/편집/삭제 | Free 최대 3개, 템플릿 5종 + 커스텀 |
| 오늘 체크인 | 완료/건너뜀 원탭, 한줄 메모(선택) |
| 스트릭 계산 | 목표 요일에 COMPLETED → 스트릭 유지/증가 / SKIPPED 또는 미체크 → 스트릭 리셋(0) |
| 배지 5종 | 첫 체크인, 3일 연속, 7일 연속, 2주 완주, 복귀 |
| 주간 리포트 | 완료율, 최고 요일, 규칙 기반 코멘트 |
| 다시 시작하기 | restartAt 업데이트, 스트릭 초기화 |
| 로컬 저장 | Storage API (Routine, Checkin, Badge, Entitlement) |
| IAP (월간/연간) | `getProductItemList` → `createOneTimePurchaseOrder` → `processProductGrant` |
| 무료 체험 (7일, 1회) | 서버 userKeyHash 기준 제한 |
| 이용권 복원 | `getPendingOrders` + `completeProductGrant` |
| 앱 내 기능 3개 등록 | 딥링크 스킴 동작 확인 |
| 토스 로그인 | 프리미엄 구간에서만 요청 (인트로 화면 포함) |

### P1 (출시 후 1~2주)

| 기능 | 상세 |
|---|---|
| 이용권 복원 (환불 감지) | `getCompletedOrRefundedOrders` → 권한 회수 |
| 데이터 내보내기 (CSV) | 선택적 기능 |
| 토스앱 버전 체크 | 미지원 버전 시 "업데이트가 필요해요" 안내 |

### P2 (Phase 2)

| 기능 | 상세 |
|---|---|
| 옵트인 리마인드 알림 | 스마트 발송 SDK |
| 공유 카드 (OG) | 주간 리포트 공유 |
| 클라우드 동기화 | 로컬 → 서버 동기화 옵션 |
| 월/분기 리포트 고도화 | 프리미엄 전용 |

### IAP 세부 요구사항

**① 상품 목록 하드코딩 금지**
- 페이월·설정의 상품명·가격·아이콘은 `IAP.getProductItemList()` 결과 우선 표시

**② processProductGrant 30초 SLA**
- 30초 내 `true` 반환 실패 시 앱인토스 환불 안내 페이지 노출 가능 → 서버 타임아웃 25초 권장

**③ 미결 주문 복원 필수**
- 앱 실행 시 로그인 상태에서 `getPendingOrders` 호출 → 미결 주문 복원

**④ 환불/권한 회수**
- `getCompletedOrRefundedOrders`에서 REFUNDED 감지 → 권한 회수 + 토스트 안내

---

## 10. 데이터 & 이벤트 (Analytics)

### 로컬 데이터 모델

```
Routine(id, title, daysOfWeek, goalPerDay, createdAt, restartAt?, archivedAt?)
  → archivedAt: 프리미엄 만료 시 3개 초과분에 설정. 재구매 시 null로 복원
Checkin(id, routineId, date(YYYY-MM-DD, KST), status(COMPLETED|SKIPPED), note?, createdAt)
  → SKIPPED: 스트릭 리셋 적용 (COMPLETED만 스트릭 유지/증가)
Badge(badgeType, earnedAt)
  → badgeType: FIRST_CHECKIN | STREAK_3 | STREAK_7 | STREAK_14 | COMEBACK
Entitlement {
  premiumUntil?: timestamp(KST)
  trialUsedLocal?: boolean
  trialExpiredBannerShown?: boolean   // 만료 후 배너 1회 표시 여부
  lastKnownUserKeyHash?: string
  lastOrderId?: string
  lastSku?: string
}
```

### 서버 데이터 (최소, 프리미엄/체험용)

```
TrialGate(userKeyHash, trialUsed, trialStartedAt, trialExpiresAt)
PurchaseEntitlement(userKeyHash, premiumUntil, lastOrderId, lastSku, updatedAt)
```

### 이벤트 택소노미

| event_name | trigger | properties | 목적 |
|---|---|---|---|
| onboarding_view | OB 화면 진입 | screen(1~3) | 온보딩 이탈 분석 |
| onboarding_complete | OB-3 완료 | - | 전환 |
| routine_create_complete | 루틴 저장 | type(template/custom) | 생성 분석 |
| checkin_complete | 완료 탭 | routineId | 체크인율 |
| checkin_skip | 건너뜀 확인 탭 (경고 토스트 이후) | routineId, prevStreak | 스트릭 리셋 분석 |
| streak_milestone | 스트릭 달성 | days(3/7/14) | 인게이지먼트 |
| badge_earned | 배지 획득 | badgeType | 인게이지먼트 |
| report_view | 리포트 탭 진입 | week | 리포트 활용 |
| paywall_view | 페이월 노출 | trigger(routine_limit/settings) | 전환 분석 |
| paywall_start_trial | 무료 체험 시작 | - | 체험 전환 |
| iap_purchase_start | 결제 시작 | sku | 전환 |
| iap_grant_success | 지급 성공 | orderId, sku | 지급 성공률 |
| iap_grant_fail | 지급 실패 | orderId, sku, errorCode | 장애 대응 |
| iap_restore_start | 복원 시작 | - | 복원 품질 |
| iap_restore_done | 복원 완료 | restored_count | 운영 |

### 운영 대시보드 지표

- DAU, D1/D7 리텐션, 체크인 완료율, 스트릭 분포, 프리미엄 전환율, IAP 지급 성공률, 복원 성공률

---

## 11. 기술/아키텍처

### 구성

- **Client**: WebView 미니앱 (React) + 앱인토스 Granite SDK + TDS
- **Local**: Storage API (`getItem` / `setItem` / `removeItem`)
- **Backend (최소)**
  - 무료 체험 1회 제한 (userKeyHash)
  - 이용권 권한 저장 (premiumUntil)
  - IAP 지급 (idempotent), 복원 보조, 주문 조회 보조

### IAP 연동 흐름

```
1. getProductItemList()       → 상품 목록 조회 (페이월 UI)
2. createOneTimePurchaseOrder() → 결제 요청
3. [앱인토스 서버] 결제 검증
4. processProductGrant({orderId}) → 파트너 서버 권한 지급 (30초 내 true)
5. completeProductGrant({orderId}) → 지급 완료 처리

복원:
  getPendingOrders() → 미결 주문 조회 → processProductGrant + completeProductGrant

환불 감지:
  getCompletedOrRefundedOrders() → REFUNDED → 권한 회수
```

### 버전 호환성

| 기능 | 최소 토스앱 | 최소 SDK | 미지원 처리 |
|---|---|---|---|
| getProductItemList / createOneTimePurchaseOrder | 5.219.0 | 1.0.3+ | "업데이트가 필요해요" + 구매 버튼 비활성 |
| getPendingOrders | iOS 5.231.0 / Android 5.235.0 | 1.4.8 | 복원 기능 제한 안내 |
| completeProductGrant / getCompletedOrRefundedOrders | iOS/Android 5.231.0 | 1.2.2 | 복원/조회 제한 안내 |

### 보안/개인정보

- 서버는 userKey를 해시(SHA-256)하여 저장 (원본 보관 금지)
- HTTPS(mTLS) 통신 (API 서버 ↔ 앱인토스 서버)
- 로컬 Storage에 민감 정보(userKey 원본) 저장 금지

### 성능 목표

- 초기 번들: 500KB 이하 목표
- 인터랙션 응답: 2초 이내 (검수 필수 요건)
- 이미지: WebP 사용, 150KB 이하/장
- 메모리 누수: 10분 연속 사용 후 이상 없음

### CORS/환경 차이 리스크

| 리스크 | 대응 |
|---|---|
| 샌드박스 ↔ 프로덕션 환경 차이 | `getOperationalEnvironment()`로 분기 처리 |
| 토스앱 버전별 SDK 기능 차이 | `isMinVersionSupported()`로 사전 체크 |
| 서버 API CORS | 앱인토스 mTLS 인증서 기반 서버-서버 통신 |

---

## 12. QA / 테스트 계획

### 테스트 범위

| 영역 | 항목 |
|---|---|
| 기능 | 루틴 CRUD, 체크인, 스트릭, 배지, 리포트, 다시 시작하기 |
| IAP | 결제 성공, 결제 취소, 지급 실패→복원, 환불 감지, 기기 변경 후 복원 |
| 토스 로그인 | 로그인 성공, 닫기 동작, 로그인 해제 후 데이터 초기화 |
| 딥링크 | 스킴 3개 진입 + 뒤로가기 홈 복귀 |
| 성능 | 인터랙션 2초 이내, 메모리 누수, 번들 크기 |
| UI | 라이트 모드 고정, 핀치줌 비활성, 내비게이션 바 |
| 빈 상태/에러 | 루틴 없음, Storage 오류, 네트워크 오류 |
| 접근성 | 명도 대비, 터치 영역, 스크린 리더 |

### IAP 필수 테스트 시나리오

1. **결제 성공** → 지급 완료 → 프리미엄 활성화 UI 확인
2. **결제 성공 + 지급 실패** → 앱 재실행 → `getPendingOrders` 복원 → 활성화 확인 (가장 중요)
3. **결제 취소** → 페이월 복귀 확인
4. **에러** (네트워크 오류/내부 오류) → 에러 안내 문구 노출 확인
5. **환불** → REFUNDED 감지 → 권한 회수 + 안내 확인

### 샌드박스 테스트 주의

- 샌드박스에서는 실제 과금 없음
- 샌드박스 상품 목록 노출 방식이 환경에 따라 다를 수 있어 "샌드박스 + 토스앱 QR 테스트" 병행 필요

### 검토 요청 전 최종 체크리스트

- [ ] 라이트 모드 고정 확인
- [ ] 핀치줌 비활성화 확인
- [ ] 내비게이션 바 (로고/더보기/닫기) 정상 노출
- [ ] 앱 내 기능 3개 딥링크 동작 + 뒤로가기 홈 복귀
- [ ] 토스 로그인 — 인트로 화면 → 닫기 동작 분기
- [ ] IAP — 금액 일치, 취소 복귀, 에러 안내, 기기 변경 복원
- [ ] 기능화되지 않은 컴포넌트 없음
- [ ] 외부 링크/자사 앱 설치 유도 없음
- [ ] 2초 이내 인터랙션 응답
- [ ] 메모리 누수 없음

---

## 13. 배포/출시/운영 계획

### 2주 개발 일정

| 기간 | 작업 |
|---|---|
| D1~3 | 생성→오늘→리포트 핵심 루프 + 로컬 저장 + 딥링크 1개 동선 확정 |
| D4~7 | 스트릭/배지 + 빈상태/복귀 UX(다시 시작하기) + 페이월 UI |
| D8~10 | IAP(상품 목록/구매/지급) + 무료 체험 1회 제한(서버) + 복원(미결 주문) |
| D11~14 | QA(필수 시나리오 5종) + 정책 문구/UX 라이팅 + 검수 대응 |

### 출시 절차

1. 콘솔 앱 정보 검토 완료 확인 (사업자 인증, 대표관리자 승인)
2. `.ait` 번들 빌드 + 콘솔 업로드
3. 검토 요청 전 최종 체크리스트 자체 검수
4. 검토 요청 → 앱인토스 팀 검수 (영업일 기준 ~5일)
5. 반려 시 사유 이메일·콘솔 확인 → 수정 후 재요청
6. 승인 → 출시 (단계적 롤아웃 또는 전체 출시)

### 버전 관리 / 롤백 / 핫픽스

| 상황 | 대응 |
|---|---|
| 심각한 버그 (결제 오류/데이터 손실) | 이전 버전 롤백 (콘솔에서 이전 번들로 교체) |
| 일반 버그 | 핫픽스 번들 빌드 → 재검토 요청 (긴급 수정 신청) |
| 정책 위반 감지 | 즉시 서비스 준비 중 전환 + 수정 후 재오픈 |

### 모니터링

- IAP 지급 성공률 (목표 99%+)
- 결제 실패율, 복원 성공률
- Sentry 에러 추적 (앱인토스 Sentry 연동 가이드 참고)
- 콘솔 성과 지표 (D+1 오전 8시 이후 업데이트)
- 수수료: 앱마켓(~15%) + 토스(~5%) (변동 가능, 콘솔 확인)

### 고객센터/문의/신고 대응

- 결제 관련 CS: iOS → Apple 환불 안내 / Android → 토스앱 환불 요청 안내
- 앱 버그/피드백: 고객센터 이메일 (콘솔 등록)
- 이용약관/개인정보처리방침: 설정 화면 내 연결

---

## 14. 리스크 & 오픈 이슈

### 정책 리스크

| 리스크 | 심각도 | 대응 |
|---|---|---|
| "무제한" 등 과장 표현 → 검수 반려 | 높음 | 콘솔 상품명/설명에 정확한 표현 사용 |
| 결제 강제 유도 오해 | 높음 | "무료로 계속 쓰기" 항상 제공, 팝업 자동 노출 금지 |
| 심리/의학적 효과 암시 문구 | 중간 | 문구 검수 체크리스트 별도 운영 |
| 유행어/밈 사용 → 검수 반려 | 낮음 | UX 라이팅 가이드 준수 |

### 기술 리스크

| 리스크 | 심각도 | 대응 |
|---|---|---|
| processProductGrant 30초 초과 | 높음 | 서버 타임아웃 25초, 미결 주문 복원 필수 |
| 기기 변경 시 권한 소실 | 높음 | 로그인 + 복원 흐름 필수 QA |
| 샌드박스 ↔ 프로덕션 환경 차이 | 중간 | 토스앱 QR 테스트 병행 |
| 토스앱 최소 버전 미달 | 중간 | `isMinVersionSupported` 체크 + 업데이트 안내 |
| 로컬 Storage 데이터 소실 (앱 삭제) | 중간 | 설정 화면에 명확 고지 (Phase 2: 동기화) |

### 오픈 이슈

모든 정책 질문이 v1.1에서 확정됐어요. 현재 오픈 이슈 없음.

| 확정 항목 | 결정 내용 |
|---|---|
| 데이터 초기화 범위 | 온보딩 플래그 포함 전체 초기화 |
| 무료 체험 만료 안내 | 만료 후 첫 접속 시 인앱 배너 1회 표시 |
| 건너뜀 스트릭 정책 | SKIPPED → 스트릭 리셋 + 사전 경고 토스트 |
| 프리미엄 만료 후 루틴 | 3개 초과분 숨김, 재구매 시 자동 복원 |
| 배지 5종 | 첫 체크인 / 3일 / 7일 / 14일 / 복귀 확정 |

---

## 15. 부록

### A. 이용권(프리미엄) 정의

- 프리미엄은 "구독"이 아닌 **기간형 이용권**이에요.
- 무료 체험은 자동 결제 없음 — 만료 후 계속 사용하려면 이용권을 구매해요.
- 기간 만료 후 루틴/체크인 데이터는 유지돼요. (프리미엄 기능만 비활성화)

### B. IAP 구현 체크리스트

| 항목 | 필수 | 완료 기준 |
|---|---|---|
| 콘솔: 상품 등록 (유형/명/설명/이미지/가격) | ✅ | 콘솔 심사 승인 + 앱 노출 |
| getProductItemList | ✅ | 페이월에 콘솔 상품 정상 표시 |
| createOneTimePurchaseOrder | ✅ | 결제 성공/취소/에러 처리 |
| processProductGrant 30초 내 true | ✅ | 성공 콜백 + 권한 반영 |
| getPendingOrders + completeProductGrant | ✅ | 결제 성공+지급 실패 시 복원 성공 |
| getCompletedOrRefundedOrders (환불 포함) | ✅ | 환불 시 권한 회수 |
| 환불 안내 (iOS/Android 분기) | ✅ | 플랫폼별 안내 문구 제공 |
| 기기 변경 후 복원 | ✅ | 로그인 → 복원 성공 확인 |

### C. 용어집

| 용어 | 설명 |
|---|---|
| 스트릭 | 루틴을 연속으로 완료한 일수 |
| 체크인 | 오늘 루틴 완료/건너뜀 여부를 기록하는 행위 |
| 다시 시작하기 | 스트릭을 초기화하고 루틴을 재시작하는 기능 |
| 기간형 이용권 | 특정 기간(월/연) 동안 프리미엄 기능을 사용하는 비소모품 IAP |
| userKeyHash | 토스 로그인 userKey의 SHA-256 해시값 (서버 식별자) |
| processProductGrant | IAP 결제 완료 후 파트너 서버에서 권한을 지급하는 콜백 함수 |

### D. 참고 링크

| 문서 | URL |
|---|---|
| 서비스 오픈 정책 | https://developers-apps-in-toss.toss.im/intro/guide.md |
| 비게임 출시 가이드 | https://developers-apps-in-toss.toss.im/checklist/app-nongame.md |
| 다크패턴 방지 정책 | https://developers-apps-in-toss.toss.im/design/consumer-ux-guide.md |
| UX 라이팅 가이드 | https://developers-apps-in-toss.toss.im/design/ux-writing.md |
| 자사 앱/외부 링크 가이드 | https://developers-apps-in-toss.toss.im/checklist/miniapp-external-link.md |
| 앱 내 기능 | https://developers-apps-in-toss.toss.im/development/test/function.md |
| 미니앱 출시 | https://developers-apps-in-toss.toss.im/development/deploy.md |
| IAP 이해하기 | https://developers-apps-in-toss.toss.im/iap/intro.md |
| IAP 콘솔 가이드 | https://developers-apps-in-toss.toss.im/iap/console.md |
| IAP 개발하기 | https://developers-apps-in-toss.toss.im/iap/develop.md |
| IAP SDK 레퍼런스 | https://developers-apps-in-toss.toss.im/bedrock/reference/framework/인앱 결제/IAP.md |
| 토스 로그인 개발하기 | https://developers-apps-in-toss.toss.im/login/develop.md |
| Storage API | https://developers-apps-in-toss.toss.im/bedrock/reference/framework/저장소/Storage.md |
| Analytics SDK | https://developers-apps-in-toss.toss.im/bedrock/reference/framework/분석/Analytics.md |
| 내비게이션 바 설정 | https://developers-apps-in-toss.toss.im/bedrock/reference/framework/UI/NavigationBar.md |
| Sentry 모니터링 | https://developers-apps-in-toss.toss.im/learn-more/sentry-monitoring.md |

---

## 정책 확정 완료 (v1.1)

모든 오픈 질문이 확정됐어요. 추가 확인 필요 항목 없음.

| # | 질문 | 확정 내용 |
|---|---|---|
| 1 | 데이터 초기화 범위 | 온보딩 플래그 **포함** 전체 초기화 → 온보딩 재표시 |
| 2 | 무료 체험 만료 안내 | 만료 후 첫 접속 시 **인앱 배너** 1회 표시 (자동 닫기 없음) |
| 3 | 건너뜀 스트릭 정책 | SKIPPED → **스트릭 리셋** + 사전 경고 토스트 ("건너뜀으로 기록하면 스트릭이 초기화돼요.") |
| 4 | 프리미엄 만료 후 루틴 | 3개 초과분 **숨김 처리** (archivedAt 설정, 데이터 보존, 재구매 시 자동 복원) |
| 5 | 배지 5종 | 첫 체크인 / 3일 연속 / 7일 연속 / 2주 완주(14일) / 복귀 **확정** |
